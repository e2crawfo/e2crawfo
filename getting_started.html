

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; nengo_mpi 0.1.0-dev docs</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="nengo_mpi 0.1.0-dev docs" href="index.html"/>
        <link rel="next" title="User Guide" href="user_guide.html"/>
        <link rel="prev" title="nengo_mpi" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> nengo_mpi
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-installation">Basic installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adapting-existing-nengo-scripts">Adapting Existing Nengo Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#partitioning">Partitioning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-scripts">Running scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_guide.html">Developer Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">nengo_mpi</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Getting Started</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/getting_started.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<span id="id1"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>At the present time, nengo_mpi is only known to be usable on Linux.
Obtaining all nengo_mpi functionality requires a working
installation of MPI, and the most recent version of nengo
and all associated dependencies.</p>
<div class="section" id="basic-installation">
<h3>Basic installation<a class="headerlink" href="#basic-installation" title="Permalink to this headline">¶</a></h3>
<p>To install nengo_mpi, we use <code class="docutils literal"><span class="pre">git</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>git clone https://github.com/nengo/nengo_mpi.git
cd nengo_mpi
python setup.py develop --user
</pre></div>
</div>
<p>If you&#8217;re using a <code class="docutils literal"><span class="pre">virtualenv</span></code> (recommended!) then you can omit the <code class="docutils literal"><span class="pre">--user</span></code> flag.
The last step is compile the <code class="docutils literal"><span class="pre">mpi_sim</span></code> C++ library, which contains most of the functionality.
To do this, <code class="docutils literal"><span class="pre">cd</span></code> into <code class="docutils literal"><span class="pre">nengo_mpi/mpi_sim</span></code> and type <code class="docutils literal"><span class="pre">make</span></code>. If an MPI implementation
is present on the system, then this process be relatively straightforward.</p>
<p>Coming soon: More info on trouble-shooting the compilation process.</p>
</div>
</div>
<div class="section" id="adapting-existing-nengo-scripts">
<h2>Adapting Existing Nengo Scripts<a class="headerlink" href="#adapting-existing-nengo-scripts" title="Permalink to this headline">¶</a></h2>
<p>Existing nengo scripts can be adapted to make use of nengo_mpi by making
just a few small modifications. The most basic change that needs to be made
is importing nengo_mpi in addition to nengo, and then using the
<code class="docutils literal"><span class="pre">nengo_mpi.Simulator</span></code> class in place of the <code class="docutils literal"><span class="pre">Simulator</span></code> class provided by nengo</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nengo_mpi</span>
<span class="kn">import</span> <span class="nn">nengo</span>

<span class="o">...</span> <span class="n">Code</span> <span class="n">to</span> <span class="n">build</span> <span class="n">network</span> <span class="o">...</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">nengo_mpi</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">(),</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">probe</span><span class="p">])</span>
</pre></div>
</div>
<p>This will run a simulation using the nengo_mpi backend, but does not yet take
advantage of parallelization. However, even without parallelization, the
nengo_mpi backend can often be quite a bit faster than the reference
implementation (see our <a class="reference internal" href="benchmarks.html#benchmarks"><span>Benchmarks</span></a>) since it is a C++ library
wrapped by a thin python layer, whereas the reference implementation is pure
python.</p>
<div class="section" id="partitioning">
<h3>Partitioning<a class="headerlink" href="#partitioning" title="Permalink to this headline">¶</a></h3>
<p>In order to have simulations run in parallel, we need a way of specifying
which nengo objects are going to be simulated on which processors. A
<code class="xref py py-class docutils literal"><span class="pre">Partitioner</span></code> is the abstraction we use to do this specification.
The most basic information that a partitioner requires is the
number of components to split the network into. We can supply this
information when creating the partitioner, and then pass the partitioner to the
Simulator object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">partitioner</span> <span class="o">=</span> <span class="n">nengo_mpi</span><span class="o">.</span><span class="n">Partitioner</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">nengo_mpi</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">partitioner</span><span class="o">=</span><span class="n">partitioner</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>The number of components we specify here acts as an upper bound on the effective
number of processors that can be used to run the simulation.</p>
<p>We can also specify a partitioning function, which accepts a graph
(corresponding to a nengo network) and a number of components, and returns
a python dictionary which gives, for each nengo object, the component it has been
assigned to. If no partitioning function is supplied, then a default
is used which simply assigns each component a roughly equal number of neurons.
A more sophisticated partitioning function (which has additional dependencies)
uses the <a class="reference external" href="http://glaros.dtc.umn.edu/gkhome/metis/metis/overview">metis</a>
package to assign objects to components in a way that minimizes
the number of nengo Connections that straddle component boundaries. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">partitioner</span> <span class="o">=</span> <span class="n">nengo_mpi</span><span class="o">.</span><span class="n">Partitioner</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">nengo_mpi</span><span class="o">.</span><span class="n">metis_partitioner</span><span class="p">)</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">nengo_mpi</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">partitioner</span><span class="o">=</span><span class="n">partitioner</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>For small networks, we can also supply a dict mapping from nengo objects to component indices:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span>
<span class="k">with</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="n">n_neurons</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="n">n_neurons</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

<span class="n">assignments</span> <span class="o">=</span> <span class="p">{</span><span class="n">A</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">B</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">nengo_mpi</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">assignments</span><span class="o">=</span><span class="n">assignments</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>Note, though, that this does not scale well and should be reserved for toy networks/demos.</p>
</div>
</div>
<div class="section" id="running-scripts">
<h2>Running scripts<a class="headerlink" href="#running-scripts" title="Permalink to this headline">¶</a></h2>
<p>To use the nengo_mpi backend without parallelization, scripts modified
as above can be run in the usual way</p>
<div class="highlight-python"><div class="highlight"><pre>python nengo_script.py
</pre></div>
</div>
<p>This will run serially, even if we have used a partitioner to specify that the
network be split up into multiple components. When a script is run, nengo_mpi
automatically detects how many MPI processes are active, and assigns
components to each process. In this case only one process (the master
process) is active, and all components will be assigned to it.</p>
<p>In order to get parallelization we need a slightly more complex invocation:</p>
<div class="highlight-python"><div class="highlight"><pre>mpirun -np NP python -m nengo_mpi nengo_script.py
</pre></div>
</div>
<p>where NP is the number of MPI processes to launch. Its fine if NP is not
equal to the number of components that the network is split into; if NP is
larger, then some MPI processes will not be assigned any component to
simulate, and if NP is smaller, some MPI processes will be assigned multiple
components to simulate.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="user_guide.html" class="btn btn-neutral float-right" title="User Guide" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="nengo_mpi" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2014, Applied Brain Research.
      Last updated on Mar 28, 2016.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0-dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>